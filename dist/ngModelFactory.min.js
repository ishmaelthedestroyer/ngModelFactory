angular.module("Factory",["EventEmitter","Endpoint","Util"]).service("Factory",["$log","$q","Model","Endpoint","EventEmitter","Util",function(a,b,c,d,e,f){var g=function(a,b){if(!(this instanceof g))return new g(a,b);e.call(this);var c=this,d={TAG:"Factory::",endpoints:{perPage:20}};return c.store={},c.Model=a,c.config=f.extend(d,b),c.Model._$init(b),c};return f.inherits(g,e),g.prototype._$dump=function(){var a=this,b=[];for(var c in a.store)b.push(a.store[c]);return b},g.prototype._$wrap=function(a){var b=this;if(b.store[a._id]){var c,d={};for(var e in a)d[e]=angular.copy(b[e]),b.store[a._id][e]=a[e];c=angular.copy(b.store[a._id]),b.emit("$update",c,d),b.store[a._id].emit("$update",c,d)}else b.store[a._id]=b.Model.apply(this,arguments),b._$registerListeners(b.store[a._id]);return b.store[a._id]},g.prototype._$registerListeners=function(b){var c=this;return b.on("$update",function(d,e){a.debug(c.config.TAG+"registerEvents",d,e),d._id!==e._id&&(a.debug(c.config.TAG+"registerEvents","_id updated."),delete c.store[b._id],c.store[b._id]=b)}),b.on("$delete",function(b){a.debug(c.config.TAG+"registerEvents","Model deleted.",b),delete c.store[b._id],c.emit("$delete",b)}),c},g.prototype.$create=function(){var a=this,b=a.Model.apply(this,arguments);return b._$isLocal=!0,a.store[b._id]=b,a._$registerListeners(a.store[b._id]),a.emit("$create",b),b},g.prototype.$find=function(a,c,d){var e=this,f=b.defer();if(!c)for(var g in e.store)if(g===a)return f.resolve(e.store[g]),f.promise;return e.Model._$request("find",a,null,null,c,d||null).then(function(a){var b=e._$wrap(a);f.resolve(b),e.emit("$find",b)})["catch"](function(a){f.reject(a)}),f.promise},g.prototype.$list=function(a,c,d,e){var f=this,g=b.defer();return f.Model._$request("list",null,a,c,d,e||null).then(function(b){var d=[];angular.forEach(b,function(a){d.push(f._$wrap(a))}),g.resolve(d),f.emit("$list",d,a,c,e)})["catch"](function(a){g.reject(a)}),g.promise},g.prototype.$map=function(){var a=b.defer();return a.promise},g.prototype.$mapSync=function(){var a=b.defer();return a.promise},g}]),angular.module("Model",["EventEmitter","Endpoint","Util"]).service("Model",["$log","$q","Endpoint","EventEmitter","Util",function(a,b,c,d,e){var f=function(a){if(!(this instanceof f))return new f(a);d.call(this);var b=this;for(var c in a)b[c]=a[c];return b};return e.inherits(f,d),f._$throttle={},f._$request=function(a,b,d,e,g,h){for(var i,j,k=this,l=k._$config.endpoints[a].path;l!==(l=l.replace(":id",b)););if(j={method:k._$config.endpoints[a].method,path:l},g&&(j.data=g),h){var m=[];for(var n in h)m.push(n+"="+h[n]);j.path+="?"+m.join("&")}if(i=j.method+j.path,f._$throttle[i])return f._$throttle[i];var o=new c.Request(j).execute();return f._$throttle[i]=o,o["finally"](function(){delete f._$throttle[i]}),o},f._$init=function(a){var b=this,c={endpoints:{prefix:"",list:{method:"GET",path:"/models"},find:{method:"GET",path:"/models/:id"},create:{method:"POST",path:"/models"},update:{method:"PUT",path:"/models/:id"},del:{method:"DELETE",path:"/models/:id"}}};return b._$config=e.extend(c,a),b},f.prototype.$serialize=function(){var a=this,b={};for(var c in a)b[c]=a[c];return delete b._events,b},f.prototype.$update=function(a){var b=this,c={};for(var d in a)c[d]=angular.copy(b[d]),b[d]=a[d];return b.emit("$update",angular.copy(b),c),b},f.prototype.$save=function(){var a=this,b=({data:a.$serialize()},a.constructor._$request(a._$isLocal?"create":"update",a._id,null,null,a.$serialize()));return b.then(function(b){a.$update(b),a._$isLocal&&delete a._$isLocal}),b},f.prototype.$delete=function(){var a=this;a.emit("$delete",a);var b=a.constructor._$request("del",a._id);return b.then(function(){})["catch"](function(){}),b},f._$init(null),f}]),angular.module("ngModelFactory",["Factory","Model"]);