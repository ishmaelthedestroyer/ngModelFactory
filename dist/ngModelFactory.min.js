angular.module("ngModelFactory.Factory",["EventEmitter","Endpoint","Util"]).service("ngModelFactory.Factory",["$log","$q","ngModelFactory.Model","ngModelFactory.mixins","Endpoint","EventEmitter","Util",function(a,b,c,d,e,f,g){var h=function(a,b){if(!(this instanceof h))return new h(a,b);f.call(this),g.extend(this,d);var c=this;return c.store={},c.Model=a,c.$init(b),c};return g.inherits(h,f),h.prototype.$dump=function(){var a=this,b=[];for(var c in a.store)a.store.hasOwnProperty(c)&&b.push(a.store[c]);return b},h.prototype.$wrap=function(a){var b,c=this;if(a._id&&c.store[a._id]){var d={};b=c.store[a._id];for(var e in a)a.hasOwnProperty(e)&&(d[e]=angular.copy(c[e]),b[e]=a[e]);c.emit("$update",b,d),c.store[a._id].emit("$update",b,d)}else b=c.Model.apply(this,arguments),b.$init(c._$config),c.$registerListeners(b),c.store[b._id]=b,c.emit("$create",b);return b},h.prototype.$registerListeners=function(b){var c=this;return b.on("$update",function(d,e){a.debug(c._$config.TAG+"registerEvents::$update",d,e),d&&d._id&&e&&e._id&&d._id!==e._id&&(a.debug(c._$config.TAG+"registerEvents","_id updated."),delete c.store[e._id],c.store[b._id]=b),c.emit("$update",b,e)}),b.on("$delete",function(b){a.debug(c._$config.TAG+"registerEvents::$delete",b),delete c.store[b._id],c.emit("$delete",b)}),c},h.prototype.$create=function(){var a=this,b=a.$wrap.apply(this,arguments);return b._$isLocal=!0,b},h.prototype.$find=function(c,d){var e=this,f=b.defer(),h="find",i=g.extend({method:e._$config.endpoints[h].method,path:e._$config.endpoints[h].path,map:{":id":c},ignoreCache:!1,throttle:!0},d);if(!i||!i.ignoreCache)for(var j in e.store)if(e.store.hasOwnProperty(j)&&j===c)return a.debug(e._$config.TAG+"$find","Found model in cache.",e.store[j]),f.resolve(e.store[j]),f.promise;return e.$request(i).then(function(a){var b=e.$wrap(a);f.resolve(b),e.emit("$find",b)})["catch"](function(a){f.reject(a)}),f.promise},h.prototype.$list=function(a){var c=this,d=b.defer(),e="list",f=g.extend({method:c._$config.endpoints[e].method,path:c._$config.endpoints[e].path,ignoreCache:!1,throttle:!0},a);return c.$request(f).then(function(a){var b=[];angular.forEach(a,function(a){b.push(c.$wrap(a))}),d.resolve(b),c.emit("$list",b)})["catch"](function(a){d.reject(a)}),d.promise},h.prototype.$query=function(a){return a&&Object.keys(a).length?this.$dump().reduce(function(b,c){for(var d in a)if(a.hasOwnProperty(d))switch(typeof a[d]){case"function":if(!a[d](c[d],c))return b;break;case"boolean":if(a[d]!==c[d])return b;break;case"string":if(a[d]!==c[d])return b;break;case"object":if(a[d]!==c[d])return b;break;default:return b}return b.push(c),b},[]):this.$dump()},h.prototype.$populate=function(){var a=b.defer();return a.promise},h.prototype.$populateSync=function(){var a=b.defer();return a.promise},h}]),angular.module("ngModelFactory.Model",["EventEmitter","Endpoint","Util"]).service("ngModelFactory.Model",["$log","$q","Endpoint","EventEmitter","ngModelFactory.mixins","Util",function(a,b,c,d,e,f){var g=function(a){if(!(this instanceof g))return new g(a);d.call(this),f.extend(this,e);var b=this;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};return f.inherits(g,d),g.prototype.$serialize=function(){var a=this,b={};for(var c in a)a.hasOwnProperty(c)&&"function"!=typeof a[c]&&(b[c]=a[c]);return delete b._$isLocal,delete b._events,b},g.prototype.$update=function(a){var b=this,c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=angular.copy(b[d]),b[d]=a[d]);return b.emit("$update",b,c),b},g.prototype.$save=function(a){var b=this,c=b._$isLocal?"create":"update",d=f.extend({method:b._$config.endpoints[c].method,path:b._$config.endpoints[c].path,data:b.$serialize(),map:{":id":b._id},ignoreCache:!0,throttle:!1},a),e=b.$request(d);return e.then(function(a){b._$isLocal&&delete b._$isLocal,b.$update(a)}),e},g.prototype.$reload=function(a){var b=this,c="find",d=f.extend({method:b._$config.endpoints[c].method,path:b._$config.endpoints[c].path,map:{":id":b._id},ignoreCache:!0,throttle:!1},a),e=b.$request(d);return e.then(function(a){b.$update(a)}),e},g.prototype.$delete=function(a){var b=this,c="del",d=f.extend({method:b._$config.endpoints[c].method,path:b._$config.endpoints[c].path,map:{":id":b._id},ignoreCache:!0,throttle:!0},a);return b.emit("$delete",b),b.$request(d)},g}]),angular.module("ngModelFactory.mixins",["Endpoint","Util"]).service("ngModelFactory.mixins",["Endpoint","Util",function(a,b){var c={};return c.$request=function(b){return new a.Request(b).execute()},c.$init=function(a){var c=this,d={TAG:"ngModelFactory::",endpoints:{prefix:"/api",list:{method:"GET",path:"/models"},find:{method:"GET",path:"/models/:id"},create:{method:"POST",path:"/models"},update:{method:"PUT",path:"/models/:id"},del:{method:"DELETE",path:"/models/:id"}}};return c._$config=b.extend(d,a),c},c}]),angular.module("ngModelFactory",["ngModelFactory.Factory","ngModelFactory.Model","ngModelFactory.mixins"]);