angular.module("Model",["EventEmitter","Endpoint","Util"]).service("Model",["$log","$q","Endpoint","EventEmitter","Util",function(a,b,c,d,e){var f=function(a){if(!(this instanceof f))return new f(a);d.call(this);var b=this;for(var c in a)b[c]=a[c];return b};return e.inherits(f,d),f._$request=function(a,b,d,e,f,g){for(var h,i=this,j=i.Model._$config.endpoints[a].path;j!==(j=j.replace(":id",b)););if(h={method:i.Model._$config.endpoints[a].method,path:j},f&&(h.data=f),g){var k=[];for(var l in g)k.push(l+"="+g[l]);h.path+="?"+k.join("&")}return new c.Request(h).execute()},f._$init=function(a){var b=this,c={endpoints:{prefix:"",list:{method:"GET",path:"/models"},find:{method:"GET",path:"/models/:id"},create:{method:"POST",path:"/models"},update:{method:"PUT",path:"/models/:id"},del:{method:"DELETE",path:"/models/:id"}}};return b._$config=e.extend(c,a),b},f.prototype.$serialize=function(){var a=this,b={};for(var c in a)b[c]=a[c];return delete b._events,b},f.prototype.$update=function(a){var b=this,c={};for(var d in a)c[d]=angular.copy(b[d]),b[d]=a[d];return b.emit("$update",angular.copy(b),c),b},f.prototype.$save=function(){var a=this,b=({data:a.$serialize()},a.constructor.Model._$request(a._$isLocal?"create":"update",a._id,null,null,a.$serialize()));return b.then(function(b){a.$update(b),a._$isLocal&&delete a._$isLocal}),b},f.prototype.$delete=function(){var a=this;a.emit("$delete",a);var b=a.constructor.Model._$request("del",a._id);return b.then(function(){})["catch"](function(){}),b},f._$init(null),f}]);