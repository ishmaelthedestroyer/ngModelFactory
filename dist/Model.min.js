angular.module("Model",["EventEmitter","Endpoint","Util"]).service("Model",["$log","$q","Endpoint","EventEmitter","Util",function(a,b,c,d,e){var f=function(a){if(!(this instanceof f))return new f(a);d.call(this);var b=this;for(var c in a)b[c]=a[c];return b};return e.inherits(f,d),f._$throttle={},f._$request=function(a,b,d,e){for(var g,h,i=this,j=i._$config.endpoints[a].path;j!==(j=j.replace(":id",b)););if(h=angular.extend({method:i._$config.endpoints[a].method,path:j},e),d&&(h.data=d),g=h.method+h.path,f._$throttle[g])return f._$throttle[g];var k=new c.Request(h).execute();return f._$throttle[g]=k,k["finally"](function(){delete f._$throttle[g]}),k},f._$init=function(a){var b=this,c={endpoints:{prefix:"",list:{method:"GET",path:"/models"},find:{method:"GET",path:"/models/:id"},create:{method:"POST",path:"/models"},update:{method:"PUT",path:"/models/:id"},del:{method:"DELETE",path:"/models/:id"}}};return b._$config=e.extend(c,a),b},f.prototype.$serialize=function(){var a=this,b={};for(var c in a)b[c]=a[c];return delete b._$isLocal,delete b._events,b},f.prototype.$update=function(a){var b=this,c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=angular.copy(b[d]),b[d]=a[d]);return b.emit("$update",b,c),b},f.prototype.$save=function(a){var b=this,c=({data:b.$serialize()},b.constructor._$request(b._$isLocal?"create":"update",b._id,b.$serialize(),a||null));return c.then(function(a){b._$isLocal&&delete b._$isLocal,b.$update(a)}),c},f.prototype.$delete=function(a){var b=this;b.emit("$delete",b);var c=b.constructor._$request("del",b._id,b.$serialize(),a||null);return c.then(function(){})["catch"](function(){}),c},f._$init(null),f}]);